# Floe Configuration
# This file contains default configuration for production (Docker) deployment.
# For local development, values are overridden with %dev profile below.


# Engine Configuration

floe.engine-type=SPARK

# Trino Engine (production - Docker internal networking)
floe.trino.jdbc-url=jdbc:trino://trino:8080
floe.trino.user=floe
floe.trino.password=
floe.trino.catalog=demo
floe.trino.schema=test
floe.trino.query-timeout-seconds=3600

# Livy Engine (production - Docker internal networking)
floe.livy.url=http://livy:8998
floe.livy.job.jar=local:///opt/floe/floe-maintenance-job.jar
floe.livy.job.main-class=com.floe.spark.job.MaintenanceJob
floe.livy.driver-memory=2g
floe.livy.executor-memory=2g


# Catalog Configuration (production - Docker internal networking)

# Catalog type: REST, HIVE, POLARIS, or NESSIE
floe.catalog.type=REST
floe.catalog.name=demo
floe.catalog.warehouse=s3://warehouse/

# REST Catalog (used when type=REST)
floe.catalog.uri=http://rest:8181

# Hive Metastore (used when type=HIVE)
# floe.catalog.hive.uri=thrift://hive-metastore:9083

# Apache Polaris (used when type=POLARIS)
# Polaris uses OAuth2 client credentials for authentication
# floe.catalog.polaris.uri=https://polaris.example.com
# floe.catalog.polaris.client-id=${POLARIS_CLIENT_ID}
# floe.catalog.polaris.client-secret=${POLARIS_CLIENT_SECRET}
# floe.catalog.polaris.principal-role=my-role

# Project Nessie (used when type=NESSIE)
# Nessie uses Bearer token (OIDC/JWT) for authentication
# floe.catalog.nessie.uri=https://nessie.example.com/api/v1
# floe.catalog.nessie.ref=main
# floe.catalog.nessie.token=${NESSIE_TOKEN}

# DataHub (used when type=DATAHUB)
# DataHub uses Personal Access Tokens (PAT) for authentication
# floe.catalog.datahub.uri=http://datahub-gms:8080/iceberg/
# floe.catalog.datahub.token=${DATAHUB_PAT}

# S3/MinIO Configuration (production - Docker internal networking)
floe.catalog.s3.endpoint=http://minio:9000
floe.catalog.s3.access-key-id=admin
floe.catalog.s3.secret-access-key=password
floe.catalog.s3.region=us-east-1


# Store Configuration (production - Docker internal networking)

floe.store.type=POSTGRES


# Database Configuration (Quarkus Agroal)

quarkus.datasource.db-kind=postgresql
quarkus.datasource.jdbc.url=jdbc:postgresql://postgres:5432/floe
quarkus.datasource.username=floe
quarkus.datasource.password=floe
quarkus.datasource.jdbc.min-size=2
quarkus.datasource.jdbc.max-size=10
# Disable datasource health check - we handle this via FLOE_STORE_TYPE
quarkus.datasource.health.enabled=false


# Database Migrations (Flyway)

# Flyway is disabled - schema is created via docker/postgres/init.sql
# Enable for production deployments that need migration support
quarkus.flyway.migrate-at-start=false
quarkus.flyway.baseline-on-migrate=false
# quarkus.flyway.baseline-version=0
# quarkus.flyway.locations=classpath:db/migration


# Authentication & Authorization

# Enable authentication (enabled by default for production)
floe.auth.enabled=true
floe.auth.header-name=X-API-Key
floe.auth.bootstrap-key=${FLOE_BOOTSTRAP_KEY:}
floe.auth.bootstrap-key-name=Bootstrap Admin

# Custom role mapping (external role name -> Floe role)
# Example: floe.auth.role-mapping.my-custom-admin=ADMIN


# OIDC Configuration (Optional - for human user authentication)

# OIDC is disabled by default. To enable, set OIDC_ENABLED=true and configure:
#   OIDC_AUTH_SERVER_URL - Your OIDC provider URL (e.g., https://keycloak.example.com/realms/floe)
#   OIDC_CLIENT_ID - Client ID from your OIDC provider
#   OIDC_CLIENT_SECRET - Client secret (optional for public clients)
#
# When disabled, authentication relies on API keys only.
# When enabled, both OIDC (Bearer tokens) and API keys are supported.

quarkus.oidc.auth-server-url=${OIDC_AUTH_SERVER_URL:http://localhost:8180/realms/placeholder}
quarkus.oidc.client-id=${OIDC_CLIENT_ID:floe-placeholder}
quarkus.oidc.credentials.secret=${OIDC_CLIENT_SECRET:placeholder-secret}
quarkus.oidc.application-type=service
quarkus.oidc.tenant-enabled=${OIDC_ENABLED:false}
quarkus.oidc.token.issuer=${OIDC_ISSUER:}
quarkus.oidc.token.audience=${OIDC_AUDIENCE:}
quarkus.oidc.roles.source=accesstoken
quarkus.oidc.roles.role-claim-path=roles


# Security Configuration

# Audit Logging (security events in structured JSON)
floe.security.audit.enabled=true
floe.security.audit.database-enabled=true
floe.security.audit.retention-days=2555
floe.security.audit.archival-enabled=false
floe.security.audit.archival-threshold-days=90
# floe.security.audit.archival-bucket=s3://my-company-audit-logs/floe/


# Server Configuration

quarkus.http.port=9091

# Health
quarkus.smallrye-health.root-path=/health
floe.health.scan-mode=metadata
floe.health.sample-limit=10000
floe.health.persistence-enabled=true
floe.health.max-reports-per-table=100
floe.health.max-report-age-days=30

# OpenAPI / Swagger UI
quarkus.smallrye-openapi.path=/api/openapi
quarkus.smallrye-openapi.info-title=Floe API
quarkus.smallrye-openapi.info-version=0.1.0
quarkus.smallrye-openapi.info-description=Iceberg Table Maintenance System
# Ignore static OpenAPI docs from dependencies (e.g., nessie-model's META-INF/openapi.yaml)
quarkus.smallrye-openapi.ignore-static-document=true
# Exclude Nessie API classes from OpenAPI scanning
mp.openapi.scan.exclude.packages=org.projectnessie
quarkus.swagger-ui.path=/api
quarkus.swagger-ui.always-include=true

# Metrics (Prometheus)
quarkus.micrometer.enabled=true
quarkus.micrometer.export.prometheus.enabled=true
quarkus.micrometer.export.prometheus.path=/metrics
quarkus.micrometer.binder.http-server.enabled=true
quarkus.micrometer.binder.http-client.enabled=true
quarkus.micrometer.binder.jvm=true
quarkus.micrometer.binder.system=true

# Logging
quarkus.log.level=INFO
quarkus.log.category."com.floe".level=DEBUG
quarkus.log.category."org.apache.iceberg".level=INFO

# Disable native build config
quarkus.native.builder-image=graalvm



# Development Profile (%dev)
# Used when running Quarkus outside Docker (localhost access to Docker services)

# Catalog - use localhost to access Docker-exposed ports
%dev.floe.catalog.uri=http://localhost:8181
%dev.floe.catalog.s3.endpoint=http://localhost:9000

# Livy - use localhost
%dev.floe.livy.url=http://localhost:8998

# Trino - use localhost with mapped port
%dev.floe.trino.jdbc-url=jdbc:trino://localhost:8085

# Postgres - use localhost with mapped port (5433->5432)
%dev.quarkus.datasource.jdbc.url=jdbc:postgresql://localhost:5433/floe

# Dev logging
%dev.quarkus.log.category."com.floe".level=DEBUG

# Dev authentication (disabled for easier development)
%dev.floe.auth.enabled=false


# Suppress warning about injecting config into @Provider
quarkus.arc.suppress-provider-injection-warning=true
