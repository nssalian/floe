{#include base}

{#title}Operations{/title}

{#header}
<header class="bg-white border-b border-slate-200">
    <div class="mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-6">
        <div class="flex items-center justify-between">
            <div>
                <h1 class="text-2xl font-semibold text-slate-900">Operations</h1>
                <p class="mt-1 text-sm text-slate-500">Maintenance operation history and status</p>
            </div>
            <div class="flex items-center gap-3">
                {! Status filter !}
                <select id="status-filter"
                        hx-get="/ui/operations/list"
                        hx-target="#operations-table-body"
                        hx-include="#status-filter"
                        hx-trigger="change"
                        hx-indicator="#table-loading"
                        name="status"
                        class="rounded-lg border border-slate-300 bg-white px-3 py-2 text-sm
                               focus:border-floe-500 focus:ring-1 focus:ring-floe-500">
                    <option value="">All Statuses</option>
                    <option value="RUNNING" {#if currentStatus == 'RUNNING'}selected{/if}>Running</option>
                    <option value="SUCCESS" {#if currentStatus == 'SUCCESS'}selected{/if}>Success</option>
                    <option value="FAILED" {#if currentStatus == 'FAILED'}selected{/if}>Failed</option>
                    <option value="PARTIAL_FAILURE" {#if currentStatus == 'PARTIAL_FAILURE'}selected{/if}>Partial Failure</option>
                    <option value="PENDING" {#if currentStatus == 'PENDING'}selected{/if}>Pending</option>
                </select>

                {! Refresh button !}
                <button onclick="window.location.reload()"
                        class="inline-flex items-center gap-2 px-3 py-2 text-sm font-medium text-floe-700
                               bg-floe-50 hover:bg-floe-100 rounded-lg transition-colors">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    Refresh
                </button>
            </div>
        </div>
    </div>
</header>
{/header}

{#content}
<div class="space-y-6">

    {! Stats summary row !}
    <div id="stats-row"
         hx-get="/ui/operations/stats-row"
         hx-trigger="load"
         hx-swap="innerHTML">
        {! Loading placeholder !}
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <div class="bg-white rounded-lg border border-slate-200 p-4 animate-pulse">
                <div class="h-4 bg-slate-200 rounded w-20 mb-2"></div>
                <div class="h-8 bg-slate-200 rounded w-16"></div>
            </div>
            <div class="bg-white rounded-lg border border-slate-200 p-4 animate-pulse">
                <div class="h-4 bg-slate-200 rounded w-20 mb-2"></div>
                <div class="h-8 bg-slate-200 rounded w-16"></div>
            </div>
            <div class="bg-white rounded-lg border border-slate-200 p-4 animate-pulse">
                <div class="h-4 bg-slate-200 rounded w-20 mb-2"></div>
                <div class="h-8 bg-slate-200 rounded w-16"></div>
            </div>
            <div class="bg-white rounded-lg border border-slate-200 p-4 animate-pulse">
                <div class="h-4 bg-slate-200 rounded w-20 mb-2"></div>
                <div class="h-8 bg-slate-200 rounded w-16"></div>
            </div>
        </div>
    </div>

    {! Operations table !}
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden relative">
        {! Table loading indicator - hidden by default, shown during htmx requests !}
        <div id="table-loading" class="htmx-indicator absolute inset-0 bg-white/50 flex items-center justify-center z-10 pointer-events-none">
            <svg class="animate-spin h-6 w-6 text-floe-600" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
            </svg>
        </div>

        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-slate-200">
                <thead class="bg-slate-50">
                <tr>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Status
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Table
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Policy
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Engine
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Started
                    </th>
                    <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">
                        Duration
                    </th>
                    <th scope="col" class="relative px-6 py-3 sticky right-0 bg-slate-50">
                        <span class="sr-only">Actions</span>
                    </th>
                </tr>
                </thead>
                <tbody id="operations-table-body"
                       class="bg-white divide-y divide-slate-200"
                       hx-get="/ui/operations/list"
                       hx-trigger="load"
                       hx-swap="innerHTML">
                {! Initial loading state !}
                <tr>
                    <td colspan="7" class="px-6 py-12 text-center text-slate-500">
                        <svg class="animate-spin h-6 w-6 mx-auto mb-2 text-floe-600" fill="none" viewBox="0 0 24 24">
                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4z"></path>
                        </svg>
                        Loading operations...
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>

</div>
{/content}

{/include}
